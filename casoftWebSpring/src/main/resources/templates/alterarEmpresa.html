<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alteração de Empresa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/estilo.css" rel="stylesheet">
  <style>

    .header-container img {
      max-width: 60px;
      height: auto;
    }
    
    .menu-toggle {
      display: none;
    }
    
    .logo-preview {
      max-width: 100%;
      max-height: 150px;
      margin-top: 10px;
      display: none;
    }
    
    .form-card {
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .form-card .card-header {
      border-radius: 10px 10px 0 0;
      border-bottom: 1px solid #eee;
    }
    
    .card-section {
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
      padding-bottom: 10px;
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #505050;
      margin-bottom: 15px;
    }
    .bg-orange { 
      background-color: #ffffff !important; 
    }
    .custom-input {
      background-color: #f7f7f7; /* Cor do fundo */
      border-color: #e0e0e0;
    }
    /* Estilos para dispositivos móveis */
    @media (max-width: 767.98px) {
      .row > * {
        margin-bottom: 10px;
      }
    }
    
  </style>
</head>
<body class="bg-light" onload="carregarEmpresa()">
  <header class="header">
    <div class="container">
      <div class="header-container">
        <img src="img/logo.png" alt="Logo">
      </div>
    </div>
  </header>
  
  <header class="header-fixed">
    <div class="container">
      <div class="header-container d-flex justify-content-between align-items-center">
        <img src="img/logo.png" alt="Logo">
        <button class="menu-toggle" id="menu-toggle">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </header>
  <div class="d-flex">
    <!-- Botão de menu -->
    <button class="menu-btn p-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuLateral">
      &#9776;
    </button>
    <!-- Menu Lateral -->
    <div class="offcanvas offcanvas-start" id="menuLateral">
      <div class="offcanvas-header">
        <h5>Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
      </div>
      <div class="offcanvas-body">
        <a href="#" class="d-block mb-2">Página Inicial</a>
        <a href="#" class="d-block mb-2">Cadastro</a>
        <a href="#" class="d-block mb-2">Relatórios</a>
        <a href="#" class="d-block">Configurações</a>
      </div>
    </div>
  </div>

  
  <div class="container mt-4 mb-5">
    <div class="row justify-content-center">
      <div class="col-lg-9 col-md-10">
        <div class="card form-card">
          <div class="card-body p-3">
              <div class="card-section bg-orange text-dark py-3">
                <h3 class="text-center ">Alteração de Empresa</h3>
              </div>
            <form method="POST" id="formEmpresa" enctype="multipart/form-data" onsubmit="return enviarFormulario(event)">
              <!-- Dados da Empresa -->
              <div class="card-section">
                <h5 class="section-title">Dados da Empresa</h5>
                <div class="row mb-3">
                  <div class="col-md-8">
                    <label for="nomeEmpresa" class="form-label">Nome da Empresa <span style="color:red;">*</span></label>
                    <input type="text" id="nomeEmpresa" name="nomeEmpresa" class="form-control custom-input" required>
                  </div>
                  <div class="col-md-4">
                    <label for="cnpj" class="form-label">CNPJ <span style="color:red;">*</span></label>
                    <input type="text" id="cnpj" name="cnpj" class="form-control custom-input" placeholder="00.000.000/0000-00" required>
                  </div>
                </div>
              </div>
              
              <!-- Endereço Completo -->
              <div class="card-section">
                <h5 class="section-title">Endereço Completo</h5>
                <div class="row mb-3">
                  <div class="col-md-8">
                    <label for="logradouro" class="form-label">Logradouro <span style="color:red;">*</span></label>
                    <input type="text" id="logradouro" name="logradouro" class="form-control custom-input" required>
                  </div>
                  <div class="col-md-4">
                    <label for="numero" class="form-label">Número <span style="color:red;">*</span></label>
                    <input type="text" id="numero" name="numero" class="form-control custom-input" required>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="bairro" class="form-label">Bairro <span style="color:red;">*</span></label>
                    <input type="text" id="bairro" name="bairro" class="form-control custom-input" required>
                  </div>
                  <div class="col-md-6">
                    <label for="complemento" class="form-label">Complemento</label>
                    <input type="text" id="complemento" name="complemento" class="form-control custom-input">
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="cidade" class="form-label">Cidade <span style="color:red;">*</span></label>
                    <input type="text" id="cidade" name="cidade" class="form-control custom-input" required>
                  </div>
                  <div class="col-md-3">
                    <label for="estado" class="form-label">Estado <span style="color:red;">*</span></label>
                    <select id="estado" name="estado" class="form-select custom-input" required>
                      <option value="">Selecione</option>
                      <option value="AC">AC</option>
                      <option value="AL">AL</option>
                      <option value="AP">AP</option>
                      <option value="AM">AM</option>
                      <option value="BA">BA</option>
                      <option value="CE">CE</option>
                      <option value="DF">DF</option>
                      <option value="ES">ES</option>
                      <option value="GO">GO</option>
                      <option value="MA">MA</option>
                      <option value="MT">MT</option>
                      <option value="MS">MS</option>
                      <option value="MG">MG</option>
                      <option value="PA">PA</option>
                      <option value="PB">PB</option>
                      <option value="PR">PR</option>
                      <option value="PE">PE</option>
                      <option value="PI">PI</option>
                      <option value="RJ">RJ</option>
                      <option value="RN">RN</option>
                      <option value="RS">RS</option>
                      <option value="RO">RO</option>
                      <option value="RR">RR</option>
                      <option value="SC">SC</option>
                      <option value="SP">SP</option>
                      <option value="SE">SE</option>
                      <option value="TO">TO</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="cep" class="form-label">CEP <span style="color:red;">*</span></label>
                    <input type="text" id="cep" name="cep" class="form-control custom-input" placeholder="00000-000" required>
                  </div>
                </div>
              </div>
              
              <!-- Contato e Identidade Visual -->
              <div class="card-section">
                <h5 class="section-title">Contato e Identidade Visual</h5>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="telefone" class="form-label">Telefone <span style="color:red;">*</span></label>
                    <input type="text" id="telefone" name="telefone" class="form-control custom-input" placeholder="(00) 00000-0000" required>
                  </div>
                  <div class="col-md-6">
                    <label for="email" class="form-label">Email <span style="color:red;">*</span></label>
                    <input type="email" id="email" name="email" class="form-control custom-input" placeholder="empresa@exemplo.com">
                  </div>
                </div>
                
                <div class="mb-4">
                  <label for="file" class="form-label">Logo da Empresa <span style="color:red;">*</span></label>
                  <input type="file" id="file" name="file" class="form-control custom-input" accept="image/*" onchange="previewLogo(this)" required>
                  <small class="text-muted">Formatos aceitos: JPG, PNG, GIF. Tamanho máximo: 2MB</small>
                  <div class="mt-2 text-center">
                    <img id="logoPreview" src="#" alt="Preview do Logo" class="logo-preview">
                  </div>
                </div>
              </div>
              
              <!-- Botões -->
              <div class="row mt-4">
                <div class="col-md-6 mb-2">
                  <button type="button" class="btn btn-secondary w-100" onclick="limparFormulario()">Limpar</button>
                </div>
                <div class="col-md-6 mb-2">
                  <button type="submit" class="btn btn-primary w-100">Alterar</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer>

  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function formatarCNPJ(cnpj) {
        return cnpj.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/, "$1.$2.$3/$4-$5");
    }

    function formatarTelefone(telefone) {
        return telefone.replace(/^(\d{2})(\d{5})(\d{4})$/, "($1) $2-$3");
    }
    function formatarCEP(cep) {
        return cep.replace(/^(\d{5})(\d{3})$/, "$1-$2");
    }
    function carregarEmpresa() {
        const URL = "http://localhost:8080/apis/param/1"; 

        fetch(URL, {
            method: "GET",
        })
        .then((response) => response.json())
        .then((data) => {
            document.getElementById('nomeEmpresa').value = data.nomeEmpresa;
            document.getElementById('cnpj').value = formatarCNPJ(data.cnpj);
            document.getElementById('logradouro').value = data.logradouro;
            document.getElementById('numero').value = data.numero;
            document.getElementById('bairro').value = data.bairro;
            document.getElementById('cidade').value = data.cidade;
            document.getElementById('estado').value = data.estado;
            document.getElementById('cep').value = formatarCEP(data.cep);
            document.getElementById('telefone').value = formatarTelefone(data.telefone);
            document.getElementById('email').value = data.email;
        })
        .catch((error) => {
            console.error("Erro ao carregar os dados da empresa:", error);
            alert("Erro ao carregar os dados da empresa. Verifique a conexão.");
        });
    }

    
    // Limpar formulário
    function limparFormulario() {
      document.getElementById('formEmpresa').reset();
      document.getElementById('logoPreview').style.display = 'none';
    }
    
    function enviarFormulario(event) {
        event.preventDefault();

        const URL = "http://localhost:8080/apis/param";
        const fdados = document.getElementById("formEmpresa");
        let formData = new FormData(fdados);

        fetch(URL, {
            method: "PUT",
            body: formData
        })
            .then(response => response.json())
            .then(json => {
            alert(json.mensagem);
            if (json.sucesso) {
                limparFormulario();
            }
            })
            .catch(error => {
            console.error("Erro ao atualizar empresa:", error);
            alert("Erro ao atualizar empresa. Por favor, tente novamente.");
            });
        return false;
    }

    // Script para mostrar o header fixo ao rolar
    let prevScrollPos = window.pageYOffset;
 
    window.onscroll = function() {
      var header = document.querySelector(".header");
      var headerFixed = document.querySelector(".header-fixed");
      var currentScrollPos = window.pageYOffset;


      if (prevScrollPos < currentScrollPos) {
        headerFixed.style.transform = "translateY(0)";
      } else if (currentScrollPos === 0) {
        headerFixed.style.transform = "translateY(-100%)";
      }

      prevScrollPos = currentScrollPos;
    };
    function toggleMenu() {
      const menu = document.querySelector(".menu");
      menu.classList.toggle("active");
    }
    
    // Formatação de CNPJ
    document.getElementById('cnpj').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 14) value = value.slice(0, 14);
      
      if (value.length > 12) {
        value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2}).*/, '$1.$2.$3/$4-$5');
      } else if (value.length > 8) {
        value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d*)/, '$1.$2.$3/$4');
      } else if (value.length > 5) {
        value = value.replace(/^(\d{2})(\d{3})(\d*)/, '$1.$2.$3');
      } else if (value.length > 2) {
        value = value.replace(/^(\d{2})(\d*)/, '$1.$2');
      }
      
      e.target.value = value;
    });
    
    // Formatação de telefone
    document.getElementById('telefone').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);
      
      if (value.length > 10) {
        value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
      } else if (value.length > 6) {
        value = value.replace(/^(\d{2})(\d{4})(\d*)/, '($1) $2-$3');
      } else if (value.length > 2) {
        value = value.replace(/^(\d{2})(\d*)/, '($1) $2');
      }
      
      e.target.value = value;
    });
    
    // Formatação de CEP
    document.getElementById('cep').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 8) value = value.slice(0, 8);
      
      if (value.length > 5) {
        value = value.replace(/^(\d{5})(\d{3}).*/, '$1-$2');
      }
      
      e.target.value = value;
    });
    
    // Busca de CEP
    document.getElementById('cep').addEventListener('blur', function(e) {
      const cep = e.target.value.replace(/\D/g, '');
      if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(response => response.json())
          .then(data => {
            if (!data.erro) {
              document.getElementById('logradouro').value = data.logradouro;
              document.getElementById('bairro').value = data.bairro;
              document.getElementById('cidade').value = data.localidade;
              document.getElementById('estado').value = data.uf;
              // Coloca o foco no campo número
              document.getElementById('numero').focus();
            }
          })
          .catch(error => console.error('Erro na busca do CEP:', error));
      }
    });
    
  </script>
</body>
</html>